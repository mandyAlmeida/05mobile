"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["237"],{4617:function(e,t,o){o.r(t),o.d(t,{__experimental_Checkout:()=>Z});var r=o(8635),i=o(4517),n=o(3064),a=o(6106),c=o(9144),l=o(4229),s=o(4462),u=o(8803);let d=e=>e[0].toUpperCase()+e.slice(1),m=e=>{var t,o,i,c,l;let{checkout:m}=e,{setIsOpen:h}=(0,a.useDrawerContext)();return(0,r.BX)(r.HY,{children:[(0,r.tZ)(a.Drawer.Body,{children:(0,r.BX)(n.Span,{elementDescriptor:n.descriptors.checkoutSuccessRoot,sx:e=>({margin:"auto",position:"relative",aspectRatio:"1/1",display:"grid",width:"100%",padding:e.space.$4,flexShrink:0}),children:[(0,r.tZ)(p,{scale:1}),(0,r.tZ)(p,{scale:.75}),(0,r.tZ)(p,{scale:.5}),(0,r.tZ)(n.Box,{elementDescriptor:n.descriptors.checkoutSuccessBadge,sx:e=>({margin:"auto",gridArea:"1/1",display:"flex",position:"relative",width:e.sizes.$16,height:e.sizes.$16,borderRadius:e.radii.$circle,backgroundImage:"linear-gradient(180deg, rgba(255, 255, 255, 0.30) 0%, rgba(0, 0, 0, 0.12) 50%, rgba(0, 0, 0, 0.30) 95.31%)",boxShadow:"0px 4px 12px 0px rgba(0, 0, 0, 0.35), 0px 1px 0px 0px rgba(255, 255, 255, 0.05) inset",":before":{content:'""',position:"absolute",inset:e.space.$1,borderRadius:e.radii.$circle,backgroundColor:e.colors.$colorBackground}}),children:(0,r.tZ)(n.Icon,{icon:s.Jr,colorScheme:"neutral",sx:{position:"relative",margin:"auto"},"aria-hidden":!0})}),(0,r.BX)(n.Span,{sx:e=>({margin:"auto",gridArea:"1/1",position:"relative",textAlign:"center",transform:"translateY(".concat(e.space.$20,")")}),children:[(0,r.tZ)(n.Heading,{elementDescriptor:n.descriptors.checkoutSuccessTitle,as:"h2",textVariant:"h2",localizationKey:(null===(t=m.subscription)||void 0===t?void 0:t.status)==="active"?(0,n.localizationKeys)("__experimental_commerce.checkout.title__paymentSuccessful"):(0,n.localizationKeys)("__experimental_commerce.checkout.title__subscriptionSuccessful")}),(0,r.tZ)(n.Text,{elementDescriptor:n.descriptors.checkoutSuccessDescription,colorScheme:"secondary",sx:e=>({textAlign:"center",paddingInline:e.space.$8,marginBlockStart:e.space.$2}),localizationKey:(null===(o=m.subscription)||void 0===o?void 0:o.status)==="active"?(0,n.localizationKeys)("__experimental_commerce.checkout.description__paymentSuccessful"):(0,n.localizationKeys)("__experimental_commerce.checkout.description__subscriptionSuccessful")})]})]})}),(0,r.BX)(a.Drawer.Footer,{sx:e=>({rowGap:e.space.$4}),children:[(0,r.BX)(a.LineItems.Root,{children:[(0,r.BX)(a.LineItems.Group,{variant:"secondary",children:[(0,r.tZ)(a.LineItems.Title,{title:(0,n.localizationKeys)("__experimental_commerce.checkout.lineItems.title__totalPaid")}),(0,r.tZ)(a.LineItems.Description,{text:m.invoice?"".concat(m.invoice.totals.grandTotal.currencySymbol).concat(m.invoice.totals.grandTotal.amountFormatted):"–"})]}),(0,r.BX)(a.LineItems.Group,{variant:"secondary",children:[(0,r.tZ)(a.LineItems.Title,{title:(null===(i=m.subscription)||void 0===i?void 0:i.status)==="active"?(0,n.localizationKeys)("__experimental_commerce.checkout.lineItems.title__paymentMethod"):(0,n.localizationKeys)("__experimental_commerce.checkout.lineItems.title__subscriptionBegins")}),(0,r.tZ)(a.LineItems.Description,{text:(null===(c=m.subscription)||void 0===c?void 0:c.status)==="active"?m.paymentSource?"".concat(d(m.paymentSource.cardType)," ⋯ ").concat(m.paymentSource.last4):"–":(null===(l=m.subscription)||void 0===l?void 0:l.periodStart)?(0,u.p6)(new Date(m.subscription.periodStart)):"–"})]}),(0,r.BX)(a.LineItems.Group,{variant:"tertiary",children:[(0,r.tZ)(a.LineItems.Title,{title:(0,n.localizationKeys)("__experimental_commerce.checkout.lineItems.title__invoiceId")}),(0,r.tZ)(a.LineItems.Description,{text:m.invoice?m.invoice.id:"–",truncateText:!0,copyText:!0,copyLabel:"Copy invoice ID"})]})]}),(0,r.tZ)(n.Button,{onClick:()=>{h&&h(!1)},localizationKey:(0,n.localizationKeys)("formButtonPrimary")})]})]})};function p(e){let{scale:t}=e;return(0,r.tZ)(n.Span,{elementDescriptor:n.descriptors.checkoutSuccessRing,sx:e=>({margin:"auto",gridArea:"1/1",width:"".concat(100*t,"%"),height:"".concat(100*t,"%"),borderWidth:1,borderStyle:"solid",borderColor:e.colors.$neutralAlpha200,borderRadius:e.radii.$circle,maskImage:"linear-gradient(to bottom, transparent 15%, black, transparent 85%)"})})}var h=o(3799),y=o(5295),g=o(4011);let x=e=>e[0].toUpperCase()+e.slice(1),_=e=>{let{checkout:t,onCheckoutComplete:o}=e,{plan:i,planPeriod:c,totals:l}=t;return(0,r.BX)(a.Drawer.Body,{children:[(0,r.tZ)(n.Box,{elementDescriptor:n.descriptors.checkoutFormLineItemsRoot,sx:e=>({padding:e.space.$4,borderBottomWidth:e.borderWidths.$normal,borderBottomStyle:e.borderStyles.$solid,borderBottomColor:e.colors.$neutralAlpha100}),children:(0,r.BX)(a.LineItems.Root,{children:[(0,r.BX)(a.LineItems.Group,{children:[(0,r.tZ)(a.LineItems.Title,{title:i.name}),(0,r.tZ)(a.LineItems.Description,{text:"".concat(i.currencySymbol," ").concat("month"===c?i.amountFormatted:i.annualMonthlyAmountFormatted),suffix:"per month".concat("annual"===c?", times 12 months":"")})]}),(0,r.BX)(a.LineItems.Group,{borderTop:!0,variant:"tertiary",children:[(0,r.tZ)(a.LineItems.Title,{title:"Subtotal"}),(0,r.tZ)(a.LineItems.Description,{text:"".concat(l.subtotal.currencySymbol," ").concat(l.subtotal.amountFormatted)})]}),(0,r.BX)(a.LineItems.Group,{variant:"tertiary",children:[(0,r.tZ)(a.LineItems.Title,{title:"Tax"}),(0,r.tZ)(a.LineItems.Description,{text:"".concat(l.taxTotal.currencySymbol," ").concat(l.taxTotal.amountFormatted)})]}),(0,r.BX)(a.LineItems.Group,{borderTop:!0,children:[(0,r.tZ)(a.LineItems.Title,{title:"Total".concat(l.totalDueNow?" Due Today":"")}),(0,r.tZ)(a.LineItems.Description,{text:"".concat(l.totalDueNow?"".concat(l.totalDueNow.currencySymbol).concat(l.totalDueNow.amountFormatted):"".concat(l.grandTotal.currencySymbol).concat(l.grandTotal.amountFormatted))})]})]})}),(0,r.tZ)(b,{checkout:t,onCheckoutComplete:o})]})},b=e=>{let{checkout:t,onCheckoutComplete:o}=e,{__experimental_commerce:s}=(0,h.cL)(),{organization:d}=(0,h.o8)(),{subscriberType:m}=(0,i.useCheckoutContext)(),[p,x]=(0,c.useState)(!0),[_,b]=(0,c.useState)(!0),[v,Z]=(0,c.useState)(!1),[k,D]=(0,c.useState)(),{data:B}=(0,l.ib)(null==s?void 0:s.getPaymentSources,{..."org"===m?{orgId:null==d?void 0:d.id}:{}},void 0,"commerce-payment-sources"),{data:I}=B||{data:[]},w=async e=>{let{paymentSourceId:r}=e;return t.confirm({paymentSourceId:r,..."org"===m?{orgId:null==d?void 0:d.id}:{}}).then(e=>{o(e)}).catch(e=>{throw e})},T=async e=>{e.preventDefault(),Z(!0),D(void 0);let t=new FormData(e.currentTarget).get("payment_source_id");try{await w({paymentSourceId:t})}catch(e){(0,u.S3)(e,[],D)}finally{Z(!1)}},C=async e=>{await w({paymentSourceId:e.id})};return(0,r.BX)(n.Col,{elementDescriptor:n.descriptors.checkoutFormElementsRoot,gap:3,sx:e=>({padding:e.space.$4}),children:[k&&(0,r.tZ)(a.Alert,{variant:"danger",sx:e=>({animation:"".concat(y.animations.textInBig," ").concat(e.transitionDuration.$slow)}),children:"string"==typeof k?k:k.message}),I.length>0&&(0,r.BX)(r.HY,{children:[(0,r.BX)(a.Disclosure.Root,{open:p,onOpenChange:x,children:[(0,r.tZ)(a.Disclosure.Trigger,{text:"Account Funds"}),(0,r.tZ)(a.Disclosure.Content,{children:(0,r.tZ)(n.Col,{gap:3,children:(0,r.tZ)(S,{checkout:t,paymentSources:I,totalDueNow:t.totals.totalDueNow||t.totals.grandTotal,onPaymentSourceSubmit:T,isSubmitting:v})})})]}),(0,r.tZ)(a.Divider,{})]}),(0,r.BX)(a.Disclosure.Root,{open:_,onOpenChange:b,children:[(0,r.tZ)(a.Disclosure.Trigger,{text:"Add a New Payment Source"}),(0,r.tZ)(a.Disclosure.Content,{children:(0,r.tZ)(i.__experimental_PaymentSourcesContext.Provider,{value:{componentName:"PaymentSources",subscriberType:m},children:(0,r.tZ)(g.M$,{checkout:t,onSuccess:C,submitLabel:(0,n.localizationKeys)("userProfile.__experimental_billingPage.paymentSourcesSection.formButtonPrimary__pay",{amount:"".concat((t.totals.totalDueNow||t.totals.grandTotal).currencySymbol).concat((t.totals.totalDueNow||t.totals.grandTotal).amountFormatted)})})})})]})]})},S=e=>{let{checkout:t,totalDueNow:o,paymentSources:i,onPaymentSourceSubmit:l,isSubmitting:u}=e,[d,m]=(0,c.useState)(t.paymentSource||i.find(e=>e.isDefault)),p=(0,c.useMemo)(()=>i.map(e=>({value:e.id,label:"".concat(x(e.cardType)," ⋯ ").concat(e.last4)})),[i]);return(0,r.BX)(n.Form,{onSubmit:l,sx:e=>({display:"flex",flexDirection:"column",rowGap:e.space.$3}),children:[(0,r.BX)(a.Select,{elementId:"paymentSource",options:p,value:(null==d?void 0:d.id)||null,onChange:e=>{m(i.find(t=>t.id===e.value))},portal:!0,children:[(0,r.tZ)("input",{name:"payment_source_id",type:"hidden",value:null==d?void 0:d.id}),(0,r.tZ)(a.SelectButton,{icon:s.OG,sx:e=>({justifyContent:"space-between",backgroundColor:e.colors.$colorBackground}),children:d&&(0,r.tZ)(g.jr,{paymentSource:d})}),(0,r.tZ)(a.SelectOptionList,{sx:e=>({paddingBlock:e.space.$1,color:e.colors.$colorText})})]}),(0,r.BX)(n.Button,{type:"submit",colorScheme:"primary",size:"sm",textVariant:"buttonLarge",sx:{width:"100%"},isLoading:u,children:["Pay ",o.currencySymbol,o.amountFormatted]})]})},v=e=>{let{planId:t,planPeriod:o,subscriberType:i,onSubscriptionComplete:a}=e,{checkout:s,isLoading:u,invalidate:d,updateCheckout:p}=(0,l.Mg)({planId:t,planPeriod:o,subscriberType:i});return((0,c.useEffect)(()=>d,[]),u)?(0,r.tZ)(n.Spinner,{sx:{margin:"auto"}}):s?(null==s?void 0:s.status)==="completed"?(0,r.tZ)(m,{checkout:s}):(0,r.tZ)(_,{checkout:s,onCheckoutComplete:e=>{p(e),null==a||a()}}):(0,r.tZ)(r.HY,{children:(0,r.tZ)(n.Alert,{colorScheme:"danger",sx:{margin:"auto"},children:"There was a problem, please try again later."})})},Z=e=>(0,r.tZ)(n.Flow.Root,{flow:"checkout",children:(0,r.tZ)(n.Flow.Part,{children:(0,r.tZ)(i.__experimental_CheckoutContext.Provider,{value:{componentName:"Checkout",...e},children:(0,r.BX)(a.Drawer.Content,{children:[(0,r.tZ)(a.Drawer.Header,{title:"Checkout"}),(0,r.tZ)(v,{...e})]})})})})}}]);